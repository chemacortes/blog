<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Chema Cortés">
  <meta name="description" content="Dobleces en python | En el último artículo del blog contaba en qué consistía doblar código1: “…un código que se pliega sobre sí mismo. Un código que...">

  <link rel="stylesheet" type="text/css" href="https://chemacortes.github.io/blog/theme/css/styles.425931e9.min.css">

  <script src="https://chemacortes.github.io/blog/theme/js/scripts.7db5858b.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://chemacortes.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Hyperreals *R Full Atom Feed" />

<meta name="keywords" content="functional programming, lambda calculus, math, programación, programming">

  <title>Dobleces en python | Hyperreals *R</title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://chemacortes.github.io/blog">
        <img src="https://s.gravatar.com/avatar/b20d114964d6d77c209aadbe9a152e87?s=80" id="logo">
      </a>
      <h2><a href="https://chemacortes.github.io/blog" class="nohover">Hyperreals *R</a></h2>
      <p>Quarks, bits y otras criaturas infinitesimales</p>
      <div class="social">
          <a href="https://twitter.com/chemacortes" title="twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
          <a href="https://github.com/chemacortes" title="github" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://bitbucket.org/chemacortes/" title="bitbucket" target="_blank" rel="noopener noreferrer"><i class="fa fa-bitbucket fa-lg"></i></a>
          <a href="https://stackoverflow.com/users/1243400/chemacortes" title="stackoverflow" target="_blank" rel="noopener noreferrer"><i class="fa fa-stack-overflow fa-lg"></i></a>
          <a href="https://linkedin.com/in/chemacortes" title="linkedin" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin fa-lg"></i></a>
      </div>
      <ul>
        <li><a href="/feeds/all.atom.xml" target="_blank" rel="noopener noreferrer">All Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/scala.atom.xml" target="_blank" rel="noopener noreferrer">Scala Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/python.atom.xml" target="_blank" rel="noopener noreferrer">Python Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/notas.atom.xml" target="_blank" rel="noopener noreferrer">Notas Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="https://mathstodon.xyz/@chemacortes" target="_blank" rel="noopener noreferrer">Mastodon<i class="fa fa-external-link-square fa-lg"></i></a></li>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="https://chemacortes.github.io/blog">Home</a>

      &#124; <a href="https://chemacortes.github.io/blog/pages/aboutme/">Quién&nbsp;soy</a>
      &#124; <a href="https://chemacortes.github.io/blog/pages/busqueda-python-es/">Búsqueda&nbsp;python-es</a>
      &#124; <a href="https://chemacortes.github.io/blog/feeds/all.atom.xml">Atom Feed</a>
      </p>
<p>
<a href="https://chemacortes.github.io/blog/index.html">Posts</a>
&#124; <a href="https://chemacortes.github.io/blog/tag/">Tags</a>
&#124; <a href="https://chemacortes.github.io/blog/category/">Categories</a>
&#124; <a href="https://chemacortes.github.io/blog/archives.html">Archive</a>
</p>    </header>

<article>
<div class="article_meta">
  <p>Posted <time data-reltime datetime="2013-02-27T21:39:00+01:00">mié 27 febrero 2013</time>
   by Chema Cortés  </p>
  <p>
  Category: <a href="https://chemacortes.github.io/blog/category/python/">Python</a>
</div>  <div class="article_title">
    <h1><a href="https://chemacortes.github.io/blog/2013/02/27/dobleces-en-python/" class="nohover">Dobleces en&nbsp;python</a></h1>
  </div>
  <div class="article_text">
    <p>En el <a href="https://chemacortes.github.io/blog/2013/02/21/collage-vs-origami/" title="Collage vs. Origami">último artículo</a> del blog contaba en qué consistía <em>doblar código</em><sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>:</p>
<blockquote>
<p><span class="dquo">&#8220;</span>&#8230;un código que se pliega sobre sí mismo. Un código que te
lleva desde un principio a un final por el camino más&nbsp;corto.&#8221;</p>
</blockquote>
<p>Para ilustrar este concepto voy a usar un trozo de código python que se ve frecuentemente entre los programadores recién llegados de otros&nbsp;lenguajes:</p>
<p><sub><em><span class="caps">NOTA</span>: se usará python 3.x para los siguientes ejemplos</em></sub></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">listar</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">num</span><span class="p">):</span>
        <span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s2">&quot; 5d&quot;</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

<span class="n">fich</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fichero.txt&quot;</span><span class="p">)</span>
<span class="n">lineas</span><span class="o">=</span><span class="n">fich</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="n">listar</span><span class="p">(</span><span class="n">lineas</span><span class="p">)</span>
</code></pre></div>

<p>Resumen: se define una función para imprimir en pantalla la lista de líneas leídas de un fichero, precedidas con el número de caracteres que tiene la&nbsp;línea.</p>
<p>Quien tenga algo de experiencia con python seguramente vea raro este código, incluso lo califique como <em>&#8220;poco pythónico&#8221;</em>. Nombrar a la función <code>listar</code>, como verbo, es señal de que el programador proviene de un lenguaje de <em>programación imperativo</em>. El programador ha buscado en python las mismas estructuras de control que tenía en su lenguaje de origen y sólo ha encontrado familiar la estructura <code>while</code>.</p>
<p>Rebuscando un poco más, tal vez encuentre cómo se usan los bucles <code>for</code> en&nbsp;python:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">listar</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">x</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s2">&quot; 5d&quot;</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>

<p>Un bucle <code>for</code> se caracteriza por concentrar en una sentencia todo el control del bucle, una gran ayuda visual para quien vaya a leer este código. La variable de control solo se modifica en la sentencia <code>for</code>, lo que evita&nbsp;errores.</p>
<p>Analizando más detenidamente, el bucle <code>for</code> itera sobre una secuencia de enteros dada por <code>range(0,num)</code>, de donde se sacan los índices con los que acceder a cada elemento de la lista <code>args</code>. Ésta sería la visión clásica de cómo operar con <code>arrays</code>.</p>
<p>Pero esta visión ha evolucionado con el tiempo hasta llegar al concepto de <em>&#8220;Colección&#8221;</em> que ya poseen casi todos los lenguajes, bien en su sintaxis, bien como librería estándar. Una <em>&#8220;Colección&#8221;</em> consiste en un grupo de objetos sobre los que puede iterar. <code>range(0,num)</code> sería una colección ordenada de números. El siguiente paso a dar sería iterar directamente sobre la&nbsp;lista:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">listar</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s2">&quot; 5d&quot;</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>

<p>Con este código hemos conseguido un doble objetivo, mejorar la legibilidad y darle más robustez al despreocuparnos por los índices de acceso. Los índices de acceso fuera de límites suelen ser origen de multitud de&nbsp;errores.</p>
<p>Pero tenemos algo más: al no usar índices hemos generalizado el uso de la función por cualquier secuencia, generador o <a href="http://docs.python.org/3/library/stdtypes.html#iterator-types" title="Tipo iterador">iterador</a>. Concretamente, los objetos <code>files</code> cumplen con el protocolo iterador, por lo que sería posible pasarlo directamente a esta función sin necesidad de volcar todas las líneas del fichero a una&nbsp;lista:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">listar</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s2">&quot; 5d&quot;</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>

<span class="n">listar</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fichero.txt&quot;</span><span class="p">))</span>
</code></pre></div>

<p>Con este último doblez hemos ganado concisión. Pero sobre hemos ahorrado recursos ya que no necesitamos leer todo el fichero en memoria. La lectura del fichero se hará progresivamente en el momento que se solicite la siguiente línea, por lo que este código debería funcionar incluso con ficheros enormes, independiente de la cantidad de memoria disponible. Sólo se empleará la memoria suficiente para cachear una pocas líneas para ir renovándolas a medida que se prosiga la lectura del&nbsp;fichero.</p>
<p>Es un buen momento para comparar esta versión del código con la original de la que hemos&nbsp;partido.</p>
<h2>Programación&nbsp;Funcional</h2>
<p>Entre doblez y doblez, hemos perdido algunas variables intermedias superfluas. Esta <em>manía</em> por deshacerse de variables intermedias es señal de estar aproximándonos a un estilo de <em>programación funcional</em>.</p>
<p>Una posible definición de <em>&#8220;Programación Funcional&#8221;</em> sería como <em>aquella programación que difiere la evaluación de una expresión hasta el momento último en el que se vaya a usar su valor</em>.</p>
<p>Para este propósito, la expresión no puede depender de factores externos como variables globales o cambios de estado. No sabemos cuándo será evaluada una expresión. Lo único posible es hacer depender el resultado de una expresión en función del valor de otra, lo que se conoce por <em>&#8220;Composición de funciones&#8221;</em> (y de ahí el nombre de programación&nbsp;funcional).</p>
<p>Este modo de diferir la evaluación es lo que hicimos con el iterador fichero, cuyas líneas no se leían hasta el momento preciso. La pregunta es ¿podemos mejorar la orientación funcional de nuestro&nbsp;código?</p>
<p>La función <code>listar</code> no devuelve nada, tan sólo busca un efecto colateral. Es lo que se conoce en otros lenguajes como <em>&#8220;procedimiento&#8221;</em> (<em>procedure</em>). En nuestra metáfora de &#8220;pliegues&#8221;, una función que no devuelve nada la podríamos considerar como un &#8220;corte&#8221;, ya que no podemos hacer nada más a partir de&nbsp;aquí.</p>
<p>¿Qué pasaría si queremos cambiar la línea que se imprime en pantalla? ¿Y si queremos parar después de imprimir un número de líneas? En este punto, lo mejor es &#8220;desdoblar&#8221; el código y darle una orientación más&nbsp;funcional:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>

<span class="k">def</span> <span class="nf">lineas</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{: 5d}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>

<span class="n">it</span><span class="o">=</span><span class="n">lineas</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;pr.py&quot;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="mi">5</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</code></pre></div>

<p>La función <code>listar</code> ha pasado a ser el iterador <code>lineas</code> que retorna las líneas ya formateadas. Asimismo, se ha cambiado la función <code>format</code> por el método <code>format</code> de los <code>strings</code> con el que se pueden formatear mejor varios valores a la vez. La impresión de las líneas en pantalla se deja para el último momento, cuando se necesita ver el resultado. Es en este momento cuando se decide cuántas líneas se van a imprimir, que es lo que hace el <code>islice</code> acortando el iterador <code>lineas</code> a 5 iteraciones. También se usa el iterador <code>enumerate</code> para ir enumerando las líneas a medida que las&nbsp;obtenemos.</p>
<p>Como se ve, una orientación funcional permite encadenar varias operaciones sin necesidad de mantener estados intermedios<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>. Además de lo que supone de ahorro de recursos, no tener que mantener un contexto con los estados intermedios hará más sencillo migrar la ejecución de un proceso a otro en programación concurrente (eg: <em>multihilo</em>). Hoy en día, tal como evolucionan los ordenadores, quien no programe pensando en la ejecución concurrente terminará programando dos&nbsp;veces.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>Puede que prefieras usar el término <a href="http://es.wikipedia.org/wiki/Refactorización" title="Refactorización"><em>&#8220;refactorizar&#8221;</em></a>, pero he pensado que es mejor dejar este término para la programación orientada a objeto y usar <em>&#8220;doblez&#8221;</em> para dar una idea más afín a la programación funcional.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>En realidad, no es del todo cierto que la función no dependa de estados externos ya que el iterador <code>it</code> que hemos pasado como argumento podría cambiar externamente entre iteraciones.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
  </div>

  <div id="article_comments">
    <div id="disqus_thread">
    </div>
  </div>

  <script id="dsq-count-scr" src="https://hyperreals.disqus.com/count.js" async></script>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = "2013/02/27/dobleces-en-python/";
        this.page.title = "Dobleces en&nbsp;python";
    };
    loadDisqus = function(sitename) {
      var d = document, s = d.createElement('script');
      s.src = 'https://hyperreals.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    };
    loadDisqus();
  </script>
</article>


    <div id="ending_message">
        <p>&copy; Chema Cortés. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>


</body>
</html>