<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Chema Cort√©s">
  <meta name="description" content="Monadas con¬†coco | ü••=üêç+üêí Iterables Si duda los Iterables es la caracter√≠stica de programaci√≥n funcional que m√°s se usa en python. Se emplean en las...">

  <link rel="stylesheet" type="text/css" href="https://chemacortes.github.io/theme/css/styles.425931e9.min.css">

  <script src="https://chemacortes.github.io/theme/js/scripts.7db5858b.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://chemacortes.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Hyperreals *R Full Atom Feed" />

<meta name="keywords" content="functional programming, lambda calculus, math, programaci√≥n, programming, coconut, functional-programming, python">

  <title>Monadas con¬†coco | Hyperreals *R</title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://chemacortes.github.io">
        <img src="https://s.gravatar.com/avatar/b20d114964d6d77c209aadbe9a152e87?s=80" id="logo">
      </a>
      <h2><a href="https://chemacortes.github.io" class="nohover">Hyperreals *R</a></h2>
      <p>Quarks, bits y otras criaturas infinitesimales</p>
      <div class="social">
          <a href="https://twitter.com/chemacortes" title="twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
          <a href="https://github.com/chemacortes" title="github" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://bitbucket.org/chemacortes/" title="bitbucket" target="_blank" rel="noopener noreferrer"><i class="fa fa-bitbucket fa-lg"></i></a>
          <a href="https://stackoverflow.com/users/1243400/chemacortes" title="stackoverflow" target="_blank" rel="noopener noreferrer"><i class="fa fa-stack-overflow fa-lg"></i></a>
          <a href="https://linkedin.com/in/chemacortes" title="linkedin" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin fa-lg"></i></a>
      </div>
      <ul>
        <li><a href="/feeds/all.atom.xml" target="_blank" rel="noopener noreferrer">All Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/scala.atom.xml" target="_blank" rel="noopener noreferrer">Scala Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/python.atom.xml" target="_blank" rel="noopener noreferrer">Python Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/notas.atom.xml" target="_blank" rel="noopener noreferrer">Notas Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="https://mathstodon.xyz/@chemacortes" target="_blank" rel="noopener noreferrer">Mastodon<i class="fa fa-external-link-square fa-lg"></i></a></li>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="https://chemacortes.github.io">Home</a>

      &#124; <a href="https://chemacortes.github.io/pages/aboutme/">Qui√©n&nbsp;soy</a>
      &#124; <a href="https://chemacortes.github.io/pages/busqueda-python-es/">B√∫squeda&nbsp;python-es</a>
      &#124; <a href="https://chemacortes.github.io/feeds/all.atom.xml">Atom Feed</a>
      </p>
<p>
<a href="https://chemacortes.github.io/index.html">Posts</a>
&#124; <a href="https://chemacortes.github.io/tag/">Tags</a>
&#124; <a href="https://chemacortes.github.io/category/">Categories</a>
&#124; <a href="https://chemacortes.github.io/archives.html">Archive</a>
</p>    </header>

<article>
<div class="article_meta">
  <p>Posted <time data-reltime datetime="2019-05-07T19:33:19+02:00">mar 07 mayo 2019</time>
   by Chema Cort√©s  </p>
  <p>Last updated <time data-reltime datetime="2019-05-07T19:47:56+02:00">mar 07 mayo 2019</time></p>
  <p>
  Category: <a href="https://chemacortes.github.io/category/coconut/">Coconut</a>
&ndash;&ndash;  Tags:
    <a href="https://chemacortes.github.io/tag/coconut/">coconut</a>,    <a href="https://chemacortes.github.io/tag/functional-programming/">functional-programming</a>,    <a href="https://chemacortes.github.io/tag/python/">python</a>  </p>
</div>  <div class="article_title">
    <h1><a href="https://chemacortes.github.io/2019/05/07/monadas-con-coco/" class="nohover">Monadas con&nbsp;coco</a></h1>
  </div>
  <div class="article_text">
    <div class="admonition hint">
<p class="admonition-title">ü••=üêç+üêí</p>
</div>
<h2>Iterables</h2>
<p>Si duda los <strong>Iterables</strong> es la caracter√≠stica de programaci√≥n funcional que m√°s se usa en python. Se emplean en las <em>compresiones de listas</em> y las <em>expresiones generadoras</em>.</p>
<p>Pero veamos algunas&nbsp;definiciones:</p>
<ul>
<li><strong>Iterable</strong>: objeto del que se puede recorrer sus elementos en orden, uno a uno. Como ejemplos, est√°n los tipos <code>list</code>, <code>str</code>, <code>tuple</code> y <code>dict</code>. Lo com√∫n es recorrer sus elementos con un bucle <code>for</code>.</li>
<li><strong>Iterador</strong>: objeto que representa un flujo de datos. Con cada uso, o bien entrega un dato, o bien produce una excepci√≥n por quedarse vac√≠o. Por dise√±o, un <code>Iterador</code> deriva de <code>Iterable</code>.</li>
<li><strong>Secuencia</strong>: <em>iterable</em> con acceso a la posici√≥n de cualquiera de sus elementos y con un tama√±o conocido. Como ejemplos est√°n los tipos <code>list</code>, <code>str</code> y <code>tuple</code>. El tipo <code>dict</code> tambi√©n funciona como secuencia, pero no se considera como tal al no accederse a sus elementos por posici√≥n num√©rica. (Es m√°s considerado como <em>mapping</em>).</li>
<li><strong>Generador</strong>: objeto que crea iteradores. Hay <em>funciones generadoras</em>, que crean un iterador cada vez que se llaman, y <em>expresiones generadoras</em>, que crean un s√≥lo&nbsp;iterador.</li>
</ul>
<p><em>Iteradores</em> y <em>secuencias</em> forman el conjunto de los <em>iterables</em>, y podemos identificarlos estructuralmente de la siguiente&nbsp;manera:</p>
<ul>
<li>Un <strong>Iterable</strong> suele tener un m√©todo <code>__iter__</code> que devuelve un iterador para recorrer en orden todos los&nbsp;elementos.</li>
<li>Un <strong>Iterador</strong> tiene un m√©todo <code>__next__</code> para entregar el siguiente&nbsp;dato.</li>
<li>Una <strong>Secuencia</strong> tiene un m√©todo <code>__getitem__</code>, para acceso a cualquier elemento, y un m√©todo <code>__len__</code>, para conocer su tama√±o. Adem√°s, pueden tener otros m√©todos como <code>count()</code>, <code>index()</code>, <code>__contains__()</code> y <code>__reversed__()</code> con los que completar la <em>clase base abstracta</em> <a href="https://docs.python.org/3.7/library/collections.abc.html#collections.abc.Sequence">collections.abc.Sequence</a>.</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<p>Aunque un <em>Iterable</em> se suele caracterizar por tener un m√©todo <code>__iter__</code>, tambi√©n las <em>secuencias</em> se consideran <em>iterables</em> aunque no tengan este&nbsp;m√©todo.</p>
</div>
<p>Caso pr√°ctico: analicemos un objeto <code>range</code> (eg: <code>dir(range(10))</code>):</p>
<ul>
<li>tiene el m√©todos <code>__iter__</code> &#8212;&gt; es un <code>Iterable</code></li>
<li>tiene los m√©todos <code>__getitem__</code> y <code>__len__</code> &#8212;&gt; es una <code>Secuencia</code></li>
<li>tiene el resto de m√©todos de <code>collections.abc.Sequence</code></li>
<li>no tiene m√©todo <code>__next__</code></li>
</ul>
<p>Los objeto <code>Range</code> son <em>secuencias</em>, no <em>iteradores</em>. Como secuencia, algunas de la operaciones que permite&nbsp;son:</p>
<ul>
<li>troceo: <code>range(100)[4:20] == range(4,20)</code></li>
<li>obtener el tama√±o: <code>len(range(100)) == 100</code></li>
<li>chequeos de pertenencia: <code>200 in range(100) == False</code></li>
<li>inversi√≥n: <code>range(100)[::-1] == range(99, -1, -1)</code></li>
</ul>
<h2>Composici√≥n de&nbsp;Iteradores</h2>
<p>Una ventaja de usar iteradores en lugar de listas es que s√≥lo necesitan memoria para procesar el elemento que est√°n trabajado, por lo que los hace muy eficientes para procesar grandes cantidades de datos o ficheros enormes que no caben enteros en&nbsp;memoria.</p>
<p>Por ejemplo, esta expresi√≥n&nbsp;generadora:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">))</span>
</code></pre></div>

<p>Como curiosidad, el n√∫mero <code>10**100</code> se llama <a href="https://es.wikipedia.org/wiki/G√∫gol">g√∫gol</a> y es un n√∫mero enormemente grande. Crear esto mismo como una lista es imposible con la memoria de los ordenadores actuales y no habr√≠a tiempo en este Universo para procesar tal cantidad de&nbsp;elementos.</p>
<p>Y sin embargo, podemos trabajar con esta expresi√≥n sin mayores problemas. Por ejemplo, para obtener los 10 primeros&nbsp;elementos:</p>
<div class="highlight"><pre><span></span><code><span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</code></pre></div>

<p>Incluso podemos usarla como base para crear nuevos&nbsp;iteradores:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">)))</span>
</code></pre></div>

<p>Equivalente a&nbsp;hacer:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">))</span>
</code></pre></div>

<p>Componer iteradores es bastante eficiente. Se van recorriendo a medida que sea necesario, sin mantener en memoria nada m√°s que los elementos estrictamente necesarios para devolver el siguiente&nbsp;elemento.</p>
<h2>map y&nbsp;filter</h2>
<p>¬øSabes cu√°l es la diferencia entre estas dos&nbsp;expresiones?</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>

<span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</code></pre></div>

<p>Para python, ambas expresiones son equivalentes: iteradores. Pero se considera que tiene m√°s <em>estilo pyth√≥nico</em> el uso de expresiones generadoras, desaconsej√°ndose completamene el uso de las funciones <code>map</code> y <code>filter</code> siempre que se&nbsp;pueda.</p>
<p>Y sin embargo, para <em>coconut</em> las funciones <code>map</code> y <code>filter</code> son fundamentales como tambi√©n lo son en <em>programaci√≥n funcional</em>.</p>
<p>El iterador que se obtiene con la expresi√≥n generadora <code>(x**2 for x in range(10*100))</code> act√∫a como si fuera una <em>caja negra</em>. Se pueden obtener los elemntos uno a uno, pero no ofrece informaci√≥n sobre su estructura interna, ni de su tama√±o, ni nada que permita su&nbsp;transfomaci√≥n.</p>
<p>En cambio, el <em>iterador map</em> en coconut (extensi√≥n de la funci√≥n <code>map</code> de python) almacena informaci√≥n tanto de la funci√≥n como de los iterables a los que se aplica, cosa que hace en los atributos <code>func</code> y <code>iters</code>, respectivamente. De este modo, <em>coconut</em> puede encadenar transformaciones de manera m√°s&nbsp;√≥ptima.</p>
<p>Por ejemplo, para obtener el √∫ltimo elemento del iterador&nbsp;anterior:</p>
<div class="highlight"><pre><span></span><code>map(x -&gt; x**2, range(10*100))[-1]
</code></pre></div>

<p>Como iterador, deber√≠a haber pasado por todos los <code>10**100</code> elementos hasta llegar al √∫ltimo, cosa que es imposible de hacer en la pr√°ctica. Sin embargo, si se prueba en <em>coconut</em>, se obtiene el √∫ltimo elemento casi al instante. En realidad, <em>coconut</em> cortocircuita todo el proceso y salta directamente al √∫ltimo elemento de <code>range(10**100)</code>, que es el √∫nico que le hace falta. Es como si hubiera aplicado primero el <code>[-1]</code> al <code>range(10**100)</code> y luego hubiera aplicado el <code>map</code>.</p>
<p>Este tipo de encapsulado, tanto de un conjunto de datos como de la funci√≥n que lo transforma, se conocen por <strong>aplicativo</strong> (<em>Applicative</em> en ingl√©s). Y a las transformaciones que podemos encadenar, una tras otra, para diferir el c√°lculo al final del todo se conoce por <strong>m√≥nadas</strong> (<em>Monad</em> en&nbsp;ingl√©s).</p>
<p>M√°s adelante veremos una definici√≥n matem√°tica formal, pero podemos considerar <strong>monad</strong> como la <em>herramienta matem√°tica</em> m√°s poderosa de un programador funcional y, algunas veces, tambi√©n la m√°s&nbsp;incomprensible.</p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread">
    </div>
  </div>

  <script id="dsq-count-scr" src="https://hyperreals.disqus.com/count.js" async></script>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = "2019/05/07/monadas-con-coco/";
        this.page.title = "Monadas con&nbsp;coco";
    };
    loadDisqus = function(sitename) {
      var d = document, s = d.createElement('script');
      s.src = 'https://hyperreals.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    };
    loadDisqus();
  </script>
</article>


    <div id="ending_message">
        <p>&copy; Chema Cort√©s. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>


</body>
</html>