<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Chema Cortés">
  <meta name="description" content="Los iteradores parecen listas, pero no lo son | En python existe cierta dualidad entre listas e iteradores. Bastantes métodos de la librería...">

  <link rel="stylesheet" type="text/css" href="https://blog.ch3m4.org/theme/css/styles.ea57ac74.min.css">

  <script src="https://blog.ch3m4.org/theme/js/scripts.ab06d70e.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://blog.ch3m4.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Hyperreals *R Full Atom Feed" />

<meta name="keywords" content="functional programming, programming, programación, lambda calculus, math, tips, iteradores">

  <title>Los iteradores parecen listas, pero no lo son | Hyperreals *R</title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://blog.ch3m4.org">
        <img src="https://s.gravatar.com/avatar/b20d114964d6d77c209aadbe9a152e87?s=80" id="logo">
      </a>
      <h2><a href="https://blog.ch3m4.org" class="nohover">Hyperreals *R</a></h2>
      <p>Quarks, bits y otras criaturas infinitesimales</p>
      <div class="social">
          <a href="https://twitter.com/chemacortes" title="twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
          <a href="https://github.com/chemacortes" title="github" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://bitbucket.org/chemacortes/" title="bitbucket" target="_blank" rel="noopener noreferrer"><i class="fa fa-bitbucket fa-lg"></i></a>
          <a href="http://stackoverflow.com/users/1243400/chemacortes" title="stackoverflow" target="_blank" rel="noopener noreferrer"><i class="fa fa-stack-overflow fa-lg"></i></a>
          <a href="https://linkedin.com/in/chemacortes" title="linkedin" target="_blank" rel="noopener noreferrer"><i class="fa fa-linkedin fa-lg"></i></a>
      </div>
      <ul>
        <li><a href="/feeds/all.atom.xml" target="_blank" rel="noopener noreferrer">All Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/scala.atom.xml" target="_blank" rel="noopener noreferrer">Scala Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="/feeds/python.atom.xml" target="_blank" rel="noopener noreferrer">Python Feeds<i class="fa fa-external-link-square fa-lg"></i></a></li>
        <li><a href="https://www.coursera.org/user/9408450118c4cfeddff015451ed358b6" target="_blank" rel="noopener noreferrer">my coursera<i class="fa fa-external-link-square fa-lg"></i></a></li>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="https://blog.ch3m4.org">Home</a>

      &#124; <a href="https://blog.ch3m4.org/pages/aboutme/">Quién&nbsp;soy</a>
      &#124; <a href="https://blog.ch3m4.org/pages/busqueda-python-es/">Búsqueda&nbsp;python-es</a>
      &#124; <a href="https://blog.ch3m4.org/feeds/all.atom.xml">Atom Feed</a>
      </p>
<p>
<a href="https://blog.ch3m4.org/index.html">Posts</a>
&#124; <a href="https://blog.ch3m4.org/tag/">Tags</a>
&#124; <a href="https://blog.ch3m4.org/category/">Categories</a>
&#124; <a href="https://blog.ch3m4.org/archives.html">Archive</a>
</p>    </header>

<article>
<div class="article_meta">
  <p>Posted <time data-timeago datetime="2016-01-18T19:55:48.102280+01:00">lun 18 enero 2016</time>
   by Chema Cortés  </p>
  <p>Last updated <time data-timeago datetime="2021-01-10T20:16:09+01:00">dom 10 enero 2021</time></p>
  <p>
  Category: <a href="https://blog.ch3m4.org/category/python/">Python</a>
&ndash;&ndash;  Tags:
    <a href="https://blog.ch3m4.org/tag/tips/">tips</a>,    <a href="https://blog.ch3m4.org/tag/iteradores/">iteradores</a>  </p>
</div>  <div class="article_title">
    <h1><a href="https://blog.ch3m4.org/drafts/2016-01-18-los-iteradores-parecen-listas-pero-no-lo-son.html" class="nohover">Los iteradores parecen listas, pero no lo&nbsp;son</a></h1>
  </div>
  <div class="article_text">
    <p>En python existe cierta dualidad entre listas e iteradores. Bastantes métodos de
la librería estándar que utilizan listas también suelen aceptar iteradores, no
siendo necesario convertir previamente el iterador en lista para invocarlos. Es
incluso posible sustituir la lista por una expresión generadora contruida a
propósito para la&nbsp;llamada.</p>
<p>Por ejemplo, imagina que necesitamos saber cuál es la mayor longitud de línea
que tenemos en un&nbsp;fichero:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fichero.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Longitud mayor:&quot;</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>No ha hecho falta leer todo el fichero en memoria, ni crear una lista con las
longitudes de cada línea. La función <code>max</code> ha sido capaz de operar con la
expresión generadora para calcular el máximo valor de línea resultante. La
principal ventaja es que no malgastamos recursos de memoria ya que el generador
ha leído el fichero línea a línea, según ha ido&nbsp;necesitando.</p>
<p>Imagina ahora que necesitamos saber la longitud media de línea que tiene un
fichero. Podemos aprovechar el módulo <code>statistics</code> y hacer algo&nbsp;parecido:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">statistics</span> <span class="kn">import</span> <span class="n">mean</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fichero.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">meanlen</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Longitud media:&quot;</span><span class="p">,</span> <span class="n">meanlen</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>El problema de los iteradores es que se &#8220;agotan&#8221;. Si quisiéramos volverlos a
usarlos, tendríamos que recrearlos de nuevo tantas veces como cálculos
hiciéramos. En el ejemplo que estamos viendo, necesitaríamos volver a leer el
fichero, lo que no es un uso eficiente de&nbsp;recursos.</p>
<p>Una técnica que podemos aplicar es una similar a las que vimos en un anterior
<a href="https://blog.ch3m4.org/2013/10/26/clausuras-en-python-parte-2/" title="Clausuras en python - Parte 2">artículo sobre clausuras</a>. Consiste en crear una clase que se encargue de
realizar los cálculos en cada&nbsp;iteración:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Calc</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>

    <span class="k">def</span> <span class="nf">iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="n">nlen</span>
        <span class="k">return</span> <span class="n">nlen</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fichero.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">calc</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Longitud mayor:&quot;</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">maxlen</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Longitud media:&quot;</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total líneas:&quot;</span><span class="p">,</span> <span class="n">calc</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>Es un código muy mejorable, pero sirve para ilustrar las posibilidades que
existen. En general, es posible operar con un iterador empleando métodos
similares a los usados con listas. No es algo intituitivo en algunos casos, como
veremos a&nbsp;continuación.</p>
<p>En la documentación del módulo <code>itertools</code> se ven algunas recetas&nbsp;interesantes:</p>
<h2>Obtener un elemento&nbsp;arbitrario</h2>
<p>&#8230;</p>
<h2>consumir un&nbsp;iterador</h2>
<p>&#8230;</p>
<h2>conversión</h2>
<p>&#8230;</p>
<h2>split&nbsp;(tee)</h2>
<p>&#8230;</p>
  </div>

<ul class="pager">
 </ul>
With category
<a href="https://blog.ch3m4.org/category/python/">Python</a>:
<ul class="pager">
 </ul>

  <div id="article_comments">
    <div id="disqus_thread">
    </div>
  </div>

  <script id="dsq-count-scr" src="https://hyperreals.disqus.com/count.js" async></script>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = "drafts/2016-01-18-los-iteradores-parecen-listas-pero-no-lo-son.html";
        this.page.title = "Los iteradores parecen listas, pero no lo&nbsp;son";
    };
    loadDisqus = function(sitename) {
      var d = document, s = d.createElement('script');
      s.src = 'https://hyperreals.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    };
    loadDisqus();
  </script>
</article>


    <div id="ending_message">
        <p>&copy; Chema Cortés. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>


<script type="text/javascript">window.addEventListener("load", lw_timeago);</script>
</body>
</html>